{% extends "layout.html" %}

{% block title %}{{ text['title'] }} {{ filename }} {% endblock%}

{% block scripts %}
<link rel="stylesheet" href="https://codemirror.net/lib/codemirror.css">
<script src="https://codemirror.net/lib/codemirror.js"></script>
<script src="https://codemirror.net/addon/mode/overlay.js"></script>
<script type="text/javascript" src="https://codemirror.net/mode/rst/rst.js"></script>

<script>
  // inserts text around the cursor or selection
  function insertAround(start, end) {
    var doc = editor;
    var cursor = doc.getCursor();

    if (doc.somethingSelected()) {
      var selection = doc.getSelection();
      doc.replaceSelection(start + selection + end);
    } else {
      // If no selection then insert start and end args and set cursor position between the two.
      doc.replaceRange(start + end, { line: cursor.line, ch: cursor.ch });
      doc.setCursor({ line: cursor.line, ch: cursor.ch + start.length });
    }
    editor.focus();
  }
</script>

<style>
.flex-container {
    display: -webkit-flex;
    display: flex;
    width: auto;
    height: 90vh;
    background-color: #7799CC;
}

.CodeMirror {
    border: 1px solid #eee;
    height: 65vh;
}

.flex-item, .flex-item-rigid {
    width: 50%;
    height: auto;
    margin: 10px;
}
.flex-item {
    overflow: scroll;
}
button
{
    margin: -1px;
    padding: 0px;
}
div.bodywrapper {
    margin: 0 0 0 0px;
}
</style>
{% endblock %}

{% macro contents() %}
  <div class="body" role="main">
    <div class="flex-container" align="left">
      <div class="flex-item-rigid">
        <p style="line-height: 200%;">
          <nobr>
            {{ text['sections'] }}
            <button onclick="insertAround('\n********\nCap&#237;tulo\n********','')">Cap</button>
            <button onclick="insertAround('\nSe&#231;&#227;o\n=====','')">Sec</button>
            <button onclick="insertAround('\nSub-se&#231;&#227;o\n---------','')">Sub</button>
          </nobr>
          <nobr>
            {{ text['style'] }}
            <button onclick="insertAround('**','**')"><b>B</b></button>
            <button onclick="insertAround('*','*')" style="font-family:verdana;"><i>I</i></button>
            <button onclick="insertAround('\n* a\n* b','')">&#x2D57</button>
            <button onclick="insertAround('\n1. a\n2. b','')">1.</button>
            <button onclick="insertAround('\n.. note::\n\n   something','')">!</button>
          </nobr>
          <nobr>
            {{ text['image'] }}
            <button onclick="insertAround('\n.. figure:: ../images/','<nome-da-figura>\n\n    legenda')">: <font size="1">&#x263a</font></button>
            <button onclick="insertAround('\n.. figure:: ../images/','<nome-da-figura>\n\n    legenda')">&#x263a</button>
            <button onclick="insertAround('\n+---+---+\n| A | B |\n+===+===+\n| 0 | 1 |\n+---+---+\n| 2 | 3 |\n+---+---+','')">&#x25EB</button>
            <button onclick="insertAround('\n.. tikz:: legenda\n\n   \\draw (0,0)--(1,0)--(.5,.6)--(0,0);','')">&#x25B3</button>
          </nobr>
          <nobr>
            Eq.:
            <button onclick="insertAround('`a`','')">: &#x1D4CD</button>
            <button onclick="insertAround('\n.. math::\n\n   a^2 = b','')">&#x1D4E7</button>
          </nobr>
          <nobr>
            {{ text['math'] }}:
            <button onclick="insertAround('\\frac{1}{2}','')">&#xBD</button>
            <button onclick="insertAround('\\sin(',')')">sin</button>
            <button onclick="insertAround('\\cos(',')')">cos</button>
            <button onclick="insertAround('\\neq','')">&#x2260</button>
            <button onclick="insertAround('\\cap','')">&#x2229</button>
            <button onclick="insertAround('\\cup','')">&#x222A</button>
            <button onclick="insertAround('\\mathbb{R}','')">&#x211D</button>
            <button onclick="insertAround('\\mathbb{Q}','')">&#x211A</button>
            <button onclick="insertAround('\\mathbb{Z}','')">&#x2124</button>
            <button onclick="insertAround('\\mathbb{N}','')">&#x2115</button>
            <button onclick="insertAround('\\in','')">&#x2208</button>
            <button onclick="insertAround('\\subset','')">&#x2282</button>
          </nobr>
        <form method="post">
          <textarea id="code" name="code">{{ rst }}</textarea>
          <br>
          <a href="/{{ project }}/view/{{ filename }}" style="text-decoration:none">
            <input type="button" value="{{ text['cancel'] }}"/>
          </a>
          <input id="preview" name="preview" type="submit" formaction="/{{ project }}/edit/{{ filename }}" value="{{ text['preview'] }}">
          <input id="submit" name="submit" type="submit" formaction="/{{ project }}/save/{{ filename }}" value="{{ text['submit'] }}">
        </form>
      </div>

      <script>
        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
          lineNumbers: false,
          lineWrapping: true,
        });
      </script>

      <div class="flex-item">
        {{ doc | safe }}
      </div>
    </div>
  </div>
{% endmacro %}

